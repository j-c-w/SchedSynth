def producer:
  for xo:
    vectorized xi in [0, 3]:
      compute
def consumer:
  parallel yo:
    alloc producer
    for yi in [0, ??]:
      compute producer
      compute
